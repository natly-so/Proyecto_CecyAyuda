<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registro Denuncia</title>
    <link rel="icon" type="image/x-icon" href="formularioIMG.png">

    <style>
        .cuadro{
          width: 550px;
          height: 500px;
          padding: auto;
          border: 6px solid rgb(179, 56, 209);
          border-radius: 15px;
          text-align: left;
          background-color: white;
          margin-top: 50px;
          margin-left: 350px;
        }
        
        .error {
          color: red;
          font-size: 12px;
          margin-left: 10px;
        }
        
        .success {
          color: green;
          font-size: 12px;
          margin-left: 10px;
        }
    </style>
</head>

<body style="background-image: url(img1.jpg);background-size: cover;">
   <div class="cuadro">
    <h1 style="color: rgb(187, 88, 207); text-align: center;">Registro de denuncia</h1>
    <form action="conexion_denuncia.php" name="denuncia" method="POST" onsubmit="return validateForm()">
       
       <label for="tipo_v" style="float: left;margin-left: 30px;margin-top: 15px;">Tipo de violencia:</label>
      <select id="tipo_v" name="tipo_v" style="background-color: rgb(244, 207, 253);float: left;margin-top: 35px;margin-left: -110px;" required onchange="saveData()">
        <option></option>
        <option value="Verbal">Verbal</option>
        <option value="Fisica">Fisica</option>
        <option value="Psicologica">Psicologica</option>
        <option value="Sexual">Sexual</option>
        <option value="Economica">Economica</option>
        <option value="Digital">Digital</option>
        <option value="Simbolica">Simbolica</option>
      </select>
       
       <label for="tipo_p" style="float: left;margin-left: 50px;margin-top:15px ;">Tipo de prueba:</label>
      <select id="tipo_p" name="tipo_p" style="background-color:rgb(244, 207, 253);float: left;margin-top: 35px;margin-left: -100px;" onchange="saveData()">
        <option></option>
        <option value=" Imagen">Imagen</option>
        <option value="Documento">Documento</option>
      </select>
         
      <label for="fecha" style="float: left;margin-left: 55px;margin-top: 15px;">Fecha:</label>
      <input type="date" id="fecha" name="fecha" style="background-color: rgb(244, 207, 253);float: left;margin-top: 35px;margin-left: -50px;" required onchange="saveData()">
       
      <label for="correo_d" style="float: left;margin-top: 20px;margin-left: 10px;">Ingresa tu correo nuevamente:</label>
      <input name="correo_d" id="correo_d" type="email" style="margin-top: 20px;margin-left: 10px;background-color: rgb(244, 207, 253);" oninput="validateEmail(); saveData();" required>
      <div id="email-error" class="error"></div>
      <div id="email-success" class="success"></div>
       
      <input type="file" id="archivo" name="archivo" style="float: left;margin-top: 20px;margin-left: 20px;" onchange="saveData()">
         
      <label for="descripcion" style="float: left; margin-left: 10px;margin-top: 20px;">Describe con detalle el asunto de tu denuncia:</label><br>
      <textarea type="text" id="descripcion" name="descripcion" rows="10" cols="65" placeholder="Escribe aqui..." style="background-color: rgb(244, 207, 253);margin-left: 10px;margin-top: -28;" required oninput="saveData()"></textarea>
      <br><br>
       
      <button type="submit" style="background-color: rgb(255, 255, 255);border: 3px solid rgb(151, 89, 231);margin-left: 20px;">Enviar denuncia</button>
      <button type="reset" style="background-color: rgb(255, 255, 255);border: 3px solid rgb(151, 89, 231);float: left;margin-left: 300px;" onclick="clearData()">Eliminar</button>
     
    </form>
     
    <a href="formulario.html">
    <button style="background-color: rgb(255, 255, 255);border: 3px solid rgb(151, 89, 231);float: left;margin-left: 20px;">Cancelar</button>
    </a>
</div>

<script>
// Email validation function
function validateEmail() {
    const email = document.getElementById('correo_d').value;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const errorDiv = document.getElementById('email-error');
    const successDiv = document.getElementById('email-success');
    
    if (email === '') {
        errorDiv.textContent = '';
        successDiv.textContent = '';
        return false;
    }
    
    if (!emailRegex.test(email)) {
        errorDiv.textContent = 'Por favor ingresa un correo electrónico válido';
        successDiv.textContent = '';
        return false;
    } else {
        errorDiv.textContent = '';
        successDiv.textContent = '✓ Correo válido';
        return true;
    }
}

// Form validation before submit
function validateForm() {
    const isEmailValid = validateEmail();
    if (!isEmailValid) {
        alert('Por favor corrige el formato del correo electrónico antes de enviar.');
        return false;
    }
    return true;
}

// Save form data
function saveData() {
    try {
        localStorage.setItem('formData', JSON.stringify({
            tipo_v: document.getElementById('tipo_v').value,
            tipo_p: document.getElementById('tipo_p').value,
            fecha: document.getElementById('fecha').value,
            correo_d: document.getElementById('correo_d').value,
            descripcion: document.getElementById('descripcion').value
        }));
    } catch (e) {
        console.log('localStorage no disponible');
    }
}

// Load saved data on page load
function loadData() {
    try {
        const savedData = localStorage.getItem('formData');
        if (savedData) {
            const data = JSON.parse(savedData);
            document.getElementById('tipo_v').value = data.tipo_v || '';
            document.getElementById('tipo_p').value = data.tipo_p || '';
            document.getElementById('fecha').value = data.fecha || '';
            document.getElementById('correo_d').value = data.correo_d || '';
            document.getElementById('descripcion').value = data.descripcion || '';
            
            // Validate email if it exists
            if (data.correo_d) {
                validateEmail();
            }
        }
    } catch (e) {
        console.log('localStorage no disponible');
    }
}

// Clear all data
function clearData() {
    try {
        localStorage.removeItem('formData');
    } catch (e) {
        console.log('localStorage no disponible');
    }
    
    document.getElementById('email-error').textContent = '';
    document.getElementById('email-success').textContent = '';
}

// Load data when page loads
window.onload = function() {
    loadData();
};
</script>

</body>
</html>